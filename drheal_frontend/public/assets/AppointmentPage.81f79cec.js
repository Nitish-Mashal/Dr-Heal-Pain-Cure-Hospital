var f=(r,e,n)=>new Promise((d,t)=>{var i=o=>{try{p(n.next(o))}catch(h){t(h)}},c=o=>{try{p(n.throw(o))}catch(h){t(h)}},p=o=>o.done?d(o.value):Promise.resolve(o.value).then(i,c);p((n=n.apply(r,e)).next())});import{C as D,o as a,c as l,b as s,J as u,K as y,F as x,r as v,A as m,E as _,G as g,L as w,M as k,N as b}from"./index.0b32a972.js";const S={name:"AppointmentPage",data(){return{isLoading:!1,slotError:" ",apiError:"",departments:[],doctors:[],appointment_types:[],selectedDoctor:null,selectedSlot:null,isFetchingSlots:!1,selectedDateIndex:null,showCalendar:!1,form:{name:"",gender:"",email:"",phone:"",age:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:"",custom_location:""},errors:{phone:"",age:""},schedule:[],availableDates:[],availableTimes:[],message:{text:"",type:""}}},created(){return f(this,null,function*(){try{const{department:r,doctor_id:e}=this.$route.query;r&&(this.form.department=r,yield this.fetchDoctors()),e&&(this.form.doctor=e,this.selectedDoctor=yield this.fetchDoctorById(e))}catch(r){console.error("Created hook error:",r)}})},computed:{formattedDate(){const r=this.availableDates[this.selectedDateIndex];return r?new Date(r.date).toDateString():"Select date"},minDate(){return new Date().toISOString().split("T")[0]}},watch:{"form.doctor"(r){return f(this,null,function*(){!r||(this.selectedDoctor=yield this.fetchDoctorById(r),yield this.fetchAppointmentTypes(r),yield this.fetchDoctorSchedule())})}},mounted(){this.fetchDepartments(),this.fetchAppointmentTypes()},methods:{formatTime(r){if(!r)return"";const e=r.split(":");return`${e[0]}:${e[1]}`},validatePhone(){this.form.phone=this.form.phone.replace(/\D/g,""),this.errors.phone=this.form.phone.length!==10?"Enter valid 10 digit number":""},validateAge(){this.errors.age=!this.form.age||this.form.age<=0?"Enter valid age":""},fetchDoctorById(r){return f(this,null,function*(){try{return(yield(yield fetch(`/api/method/drheal_frontend.api.App_api.get_doctor?id=${r}`)).json()).message||null}catch(e){return console.error("Doctor fetch error:",e),null}})},fetchAppointmentTypes(r){return f(this,null,function*(){var e;try{const d=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_appointment_types?practitioner=${r}`)).json();((e=d.message)==null?void 0:e.status)==="success"&&(this.appointment_types=d.message.data)}catch(n){console.error("Appointment type fetch error:",n)}})},fetchDepartments(){return f(this,null,function*(){var n;const e=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.get_departments")).json();((n=e.message)==null?void 0:n.status)==="success"&&(this.departments=e.message.data.map(d=>d.department))})},fetchDoctors(){return f(this,null,function*(){var n;if(!this.form.department)return;const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_practitioners?department=${encodeURIComponent(this.form.department)}`)).json();((n=e.message)==null?void 0:n.status)==="success"&&(this.doctors=e.message.data)})},fetchDoctorSchedule(){return f(this,null,function*(){if(this.availableDates=[],this.availableTimes=[],this.selectedDateIndex=null,this.schedule=[],!!this.form.doctor)try{const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}`)).json();if(!Array.isArray(e.message))return;this.schedule=e.message,this.availableDates=this.generateNext7Days(this.schedule),this.availableTimes=[],this.availableDates.length&&(yield this.selectDate(0))}catch(r){console.error("Error fetching doctor schedule:",r)}})},generateNext7Days(r){const e=new Date,n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=[];for(let t=0;t<7;t++){const i=new Date;i.setDate(e.getDate()+t);const c=n[i.getDay()];r.some(p=>p.day===c)&&d.push({date:i.toISOString().split("T")[0],day:c})}return d},toggleCalendar(){this.showCalendar=!this.showCalendar},openCalendar(){const r=this.$refs.hiddenDateInput;!r||(r.showPicker?r.showPicker():(r.focus(),r.click()))},onCalendarSelect(r){this.showCalendar=!1;const e=this.availableDates.findIndex(n=>n.date===r);e!==-1?this.selectDate(e):(this.form.date=r,this.availableTimes=[],this.selectedSlot=null)},selectDate(r){return f(this,null,function*(){if(!this.isFetchingSlots&&!(!this.availableDates||!this.availableDates[r])){this.isFetchingSlots=!0,this.availableTimes=[],this.selectedSlot=null;try{this.selectedDateIndex=r,this.form.date=this.availableDates[r].date;const n=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}&appointment_date=${this.form.date}`)).json();if(!n||!Array.isArray(n.message)||n.message.length===0){this.availableTimes=[];return}const d=Array.from(new Map(n.message.map(t=>[`${t.from_time}-${t.to_time}`,t])).values());this.availableTimes=d.map((t,i)=>{var p;const c=(p=t.token_no)!=null?p:i+1;return{id:`${c}-${t.from_time}-${t.to_time}-${this.form.date}`,display:`${t.from_time} - ${t.to_time}`,value:t.from_time,token_no:`Token ${c}`,booked:Boolean(t.booked)}})}catch(e){console.error("Error fetching slots:",e),this.availableTimes=[]}finally{this.isFetchingSlots=!1}}})},prevDate(){this.selectedDateIndex>0&&this.selectDate(this.selectedDateIndex-1)},nextDate(){this.selectedDateIndex<this.availableDates.length-1&&this.selectDate(this.selectedDateIndex+1)},selectSlot(r){r.booked||(this.selectedSlot=r,this.form.time=r.value,this.form.token_no=r.token_no,this.slotError="")},submitAppointment(){return f(this,null,function*(){var r,e;if(!this.selectedSlot){this.slotError="Please select time slot";return}this.slotError="",this.apiError="",this.isLoading=!0;try{const n=new FormData;n.append("name1",this.form.name),n.append("email",this.form.email),n.append("gender",this.form.gender),n.append("appointment_type",this.form.appointment_type),n.append("appointment_date",this.form.date),n.append("appointment_time",this.form.time),n.append("practitioner",this.form.doctor),n.append("department",this.form.department),n.append("notes",this.form.message||""),n.append("phone",this.form.phone),n.append("age",this.form.age),n.append("token_no",this.selectedSlot.token_no),n.append("custom_location",this.form.custom_location);const t=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.create_appointment",{method:"POST",body:n})).json();if(console.log("\u2705 API Response:",t),((r=t==null?void 0:t.message)==null?void 0:r.status)==="error"){this.apiError=t.message.message;return}if(((e=t==null?void 0:t.message)==null?void 0:e.status)==="success"){const i=t.message;this.resetForm(),this.$router.push({path:"/thank-you",state:{appointmentId:i.appointment_id,appointmentDate:i.appointment_date,appointmentTime:i.appointment_time,token_no:i.token_no,practitioner_id:i.practitioner}});return}}catch(n){console.error("Network/API Error:",n),this.apiError="Something went wrong. Please contact directly through given phone number."}finally{this.isLoading=!1}})},resetForm(){this.form={name:"",gender:"",email:"",phone:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:""},this.doctors=[]}}},A={class:"max-w-6xl mx-auto px-4 mt-3"},T={class:"bg-white rounded-xl shadow p-3"},C={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},I={class:"flex flex-col"},E=["value"],V={class:"flex flex-col"},U=["value"],P={class:"px-4 py-10 grid grid-cols-1 lg:grid-cols-2 gap-6 max-w-6xl mx-auto"},F={key:0,class:"bg-white rounded-xl p-4 shadow"},M={class:"text-lg font-semibold mb-4"},j={class:"flex justify-center items-center gap-4 mb-6 relative"},N=["disabled"],B=["disabled"],L=["min"],R={key:0,class:"text-center text-gray-500 mt-4"},q={class:"grid grid-cols-3 gap-3"},G=["onClick","disabled"],O={class:"text-xs"},z={class:"rounded-xl shadow"},H={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},J={class:"flex flex-col"},K={class:"flex flex-col"},W={key:0,class:"text-red-500 text-sm mt-1"},Q={class:"flex flex-col"},X={key:0,class:"text-red-500 text-sm mt-1"},Y={class:"flex flex-col"},Z={class:"flex flex-col"},$=["value"],ee={class:"flex flex-col"},te={class:"flex flex-col md:col-span-2 h-20"},oe={class:"flex flex-col md:col-span-2 h-20"},se=["disabled"],re={key:0,class:"text-red-500 text-sm mt-3 text-center"},ne={key:1,class:"text-red-600 text-sm mt-2 text-center"};function ie(r,e,n,d,t,i){var c,p;return a(),l(x,null,[s("div",A,[s("div",T,[s("div",C,[s("div",I,[e[19]||(e[19]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Department *",-1)),u(s("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.form.department=o),onChange:e[1]||(e[1]=(...o)=>i.fetchDoctors&&i.fetchDoctors(...o)),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[18]||(e[18]=s("option",{value:""},"Select Department",-1)),(a(!0),l(x,null,v(t.departments,o=>(a(),l("option",{key:o,value:o},m(o),9,E))),128))],544),[[y,t.form.department]])]),s("div",V,[e[21]||(e[21]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Doctor *",-1)),u(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.form.doctor=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[20]||(e[20]=s("option",{value:""},"Select Doctor",-1)),(a(!0),l(x,null,v(t.doctors,o=>(a(),l("option",{key:o.name,value:o.name},m(o.full_name||o.first_name),9,U))),128))],512),[[y,t.form.doctor]])])])])]),s("section",P,[s("div",null,[t.availableDates.length?(a(),l("div",F,[e[23]||(e[23]=s("h2",{class:"font-bold text-xl mb-2 text-[#065f7f]"}," Select Appointment Slots ",-1)),s("h3",M,m((c=t.selectedDoctor)==null?void 0:c.first_name)+" \u2013 "+m((p=t.selectedDoctor)==null?void 0:p.department),1),s("div",j,[s("button",{onClick:e[3]||(e[3]=(...o)=>i.prevDate&&i.prevDate(...o)),class:"w-8 h-8 border rounded-full",disabled:t.selectedDateIndex===0}," \u2039 ",8,N),s("div",{class:"px-6 py-2 rounded-full bg-green-100 text-green-700 font-semibold flex items-center gap-2 cursor-pointer select-none",onClick:e[4]||(e[4]=(...o)=>i.openCalendar&&i.openCalendar(...o))},[e[22]||(e[22]=s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3M3 11h18M5 21h14a2 2 0 002-2V7H3v12a2 2 0 002 2z"})],-1)),_(" "+m(i.formattedDate||"Select date"),1)]),s("button",{onClick:e[5]||(e[5]=(...o)=>i.nextDate&&i.nextDate(...o)),class:"w-8 h-8 border rounded-full",disabled:t.selectedDateIndex===t.availableDates.length-1}," \u203A ",8,B),s("input",{ref:"hiddenDateInput",type:"date",class:"absolute opacity-0 pointer-events-none",style:{width:"1px",height:"1px"},min:i.minDate,onChange:e[6]||(e[6]=o=>i.onCalendarSelect(o.target.value))},null,40,L)]),!t.isFetchingSlots&&t.availableTimes.length===0?(a(),l("p",R," No slots available for selected date ")):g("",!0),s("div",q,[(a(!0),l(x,null,v(t.availableTimes,o=>{var h;return a(),l("button",{key:o.id,onClick:ae=>!o.booked&&i.selectSlot(o),disabled:o.booked,class:w(["border rounded-lg py-2 text-sm transition w-full",o.booked?"bg-red-500 text-white cursor-not-allowed":((h=t.selectedSlot)==null?void 0:h.id)===o.id?"bg-green-500 text-white":"bg-white hover:bg-green-50 cursor-pointer"])},[s("div",null,m(i.formatTime(o.display)),1),s("div",O,m(o.token_no),1)],10,G)}),128))])])):g("",!0)]),s("div",z,[s("form",{onSubmit:e[17]||(e[17]=k((...o)=>i.submitAppointment&&i.submitAppointment(...o),["prevent"])),class:"bg-white p-6 rounded-xl shadow-md space-y-6"},[s("div",H,[s("div",J,[e[24]||(e[24]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Name *",-1)),u(s("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>t.form.name=o),required:"",placeholder:"Enter your name",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[b,t.form.name]])]),s("div",K,[e[25]||(e[25]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Phone *",-1)),u(s("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.form.phone=o),onInput:e[9]||(e[9]=(...o)=>i.validatePhone&&i.validatePhone(...o)),maxlength:"10",placeholder:"Enter 10 digit mobile number",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[b,t.form.phone]]),t.errors.phone?(a(),l("p",W,m(t.errors.phone),1)):g("",!0)]),s("div",Q,[e[26]||(e[26]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Age *",-1)),u(s("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.form.age=o),type:"number",onInput:e[11]||(e[11]=(...o)=>i.validateAge&&i.validateAge(...o)),placeholder:"Enter your age",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[b,t.form.age]]),t.errors.age?(a(),l("p",X,m(t.errors.age),1)):g("",!0)]),s("div",Y,[e[28]||(e[28]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Gender *",-1)),u(s("select",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.form.gender=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[...e[27]||(e[27]=[s("option",{value:""},"Select Gender",-1),s("option",null,"Male",-1),s("option",null,"Female",-1)])],512),[[y,t.form.gender]])]),s("div",Z,[e[30]||(e[30]=s("label",{class:"mb-1 font-semibold text-gray-700"}," Appointment Type * ",-1)),u(s("select",{"onUpdate:modelValue":e[13]||(e[13]=o=>t.form.appointment_type=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[29]||(e[29]=s("option",{value:""},"Select Type",-1)),(a(!0),l(x,null,v(t.appointment_types,o=>(a(),l("option",{key:o.name,value:o.appointment_type},m(o.appointment_type),9,$))),128))],512),[[y,t.form.appointment_type]])]),s("div",ee,[e[31]||(e[31]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Email",-1)),u(s("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>t.form.email=o),type:"email",placeholder:"Enter your email",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[b,t.form.email]])]),s("div",te,[e[32]||(e[32]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Location",-1)),u(s("textarea",{"onUpdate:modelValue":e[15]||(e[15]=o=>t.form.custom_location=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[b,t.form.custom_location]])]),s("div",oe,[e[33]||(e[33]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Message",-1)),u(s("textarea",{"onUpdate:modelValue":e[16]||(e[16]=o=>t.form.message=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[b,t.form.message]])])]),s("button",{type:"submit",disabled:t.isLoading,class:"w-full bg-color-blue text-white py-2 font-bold rounded-lg hover:bg-[#162059] transition disabled:opacity-50"},m(t.isLoading?"Submitting...":"SUBMIT"),9,se),t.slotError?(a(),l("p",re,m(t.slotError),1)):g("",!0),t.apiError?(a(),l("p",ne,m(t.apiError),1)):g("",!0)],32)])]),e[34]||(e[34]=s("div",{class:"max-w-xl mx-auto bg-white rounded-xl shadow-md p-6 text-center"},[s("p",{class:"text-gray-900 mb-4"}," To book an appointment directly, please call the number below. "),s("a",{href:"tel:07969288000",class:"inline-flex items-center justify-center w-full bg-color-blue text-white font-medium py-2 rounded-lg hover:bg-blue-700 transition"}," Call 07969288000 ")],-1))],64)}var me=D(S,[["render",ie]]);export{me as default};
