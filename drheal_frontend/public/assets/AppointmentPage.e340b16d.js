var p=(r,e,n)=>new Promise((i,s)=>{var a=u=>{try{c(n.next(u))}catch(v){s(v)}},o=u=>{try{c(n.throw(u))}catch(v){s(v)}},c=u=>u.done?i(u.value):Promise.resolve(u.value).then(a,o);c((n=n.apply(r,e)).next())});import{_ as D,b as l,c as d,d as t,I as _,J as f,K as h,t as m,E as y,L as b,F as g,g as x,M as w}from"./index.ea9cd284.js";const k={name:"AppointmentPage",data(){return{isLoading:!1,slotError:" ",departments:[],doctors:[],appointment_types:[],selectedDoctor:null,selectedSlot:null,isFetchingSlots:!1,selectedDateIndex:null,form:{name:"",gender:"",email:"",phone:"",age:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:"",custom_location:""},errors:{phone:"",age:""},schedule:[],availableDates:[],availableTimes:[],message:{text:"",type:""}}},created(){return p(this,null,function*(){try{const{department:r,doctor_id:e}=this.$route.query;if(r&&(this.form.department=r),e){this.form.doctor=e;const n=yield this.fetchDoctorById(e);n&&!this.doctors.find(i=>i.name===n.name)&&this.doctors.push(n)}this.form.department&&!this.form.doctor&&(yield this.fetchDoctors())}catch(r){console.error("Created hook error:",r)}})},computed:{formattedDate(){const r=this.availableDates[this.selectedDateIndex];return r?new Date(r.date).toDateString():""}},watch:{"form.doctor"(r){return p(this,null,function*(){!r||(this.selectedDoctor=yield this.fetchDoctorById(r),yield this.fetchAppointmentTypes(r),yield this.fetchDoctorSchedule())})}},mounted(){this.fetchDepartments(),this.fetchAppointmentTypes()},methods:{formatTime(r){if(!r)return"";const e=r.split(":");return`${e[0]}:${e[1]}`},validatePhone(){this.form.phone=this.form.phone.replace(/\D/g,""),this.errors.phone=this.form.phone.length!==10?"Enter valid 10 digit number":""},validateAge(){this.errors.age=!this.form.age||this.form.age<=0?"Enter valid age":""},fetchDoctorById(r){return p(this,null,function*(){try{return(yield(yield fetch(`/api/method/drheal_frontend.api.App_api.get_doctor?id=${r}`)).json()).message||null}catch(e){return console.error("Doctor fetch error:",e),null}})},fetchAppointmentTypes(r){return p(this,null,function*(){var e;try{const i=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_appointment_types?practitioner=${r}`)).json();((e=i.message)==null?void 0:e.status)==="success"&&(this.appointment_types=i.message.data)}catch(n){console.error("Appointment type fetch error:",n)}})},fetchDepartments(){return p(this,null,function*(){var n;const e=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.get_departments")).json();((n=e.message)==null?void 0:n.status)==="success"&&(this.departments=e.message.data.map(i=>i.department))})},fetchDoctors(){return p(this,null,function*(){var n;if(!this.form.department)return;const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_practitioners?department=${encodeURIComponent(this.form.department)}`)).json();((n=e.message)==null?void 0:n.status)==="success"&&(this.doctors=e.message.data)})},fetchDoctorSchedule(){return p(this,null,function*(){if(this.availableDates=[],this.availableTimes=[],this.selectedDateIndex=null,this.schedule=[],!!this.form.doctor)try{const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}`)).json();if(!Array.isArray(e.message))return;this.schedule=e.message,this.availableDates=this.generateNext7Days(this.schedule),this.availableTimes=[],this.availableDates.length&&(yield this.selectDate(0))}catch(r){console.error("Error fetching doctor schedule:",r)}})},generateNext7Days(r){const e=new Date,n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=[];for(let s=0;s<7;s++){const a=new Date;a.setDate(e.getDate()+s);const o=n[a.getDay()];r.some(c=>c.day===o)&&i.push({date:a.toISOString().split("T")[0],day:o})}return i},selectDate(r){return p(this,null,function*(){if(!!this.availableDates[r]&&!this.isFetchingSlots){this.isFetchingSlots=!0;try{this.selectedDateIndex=r,this.form.date=this.availableDates[r].date,this.availableTimes=[],this.selectedSlot=null;const n=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}&appointment_date=${this.form.date}`)).json();if(!Array.isArray(n.message))return;const i=Array.from(new Map(n.message.map(s=>[`${s.from_time}-${s.to_time}`,s])).values());this.availableTimes=i.map((s,a)=>({id:`${s.token_no}-${s.from_time}-${s.to_time}-${this.form.date}`,display:`${s.from_time} - ${s.to_time}`,value:s.from_time,token_no:s.token_no||a+1,booked:!!s.booked}))}catch(e){console.error("Error fetching slots:",e)}finally{this.isFetchingSlots=!1}}})},prevDate(){this.selectedDateIndex>0&&this.selectDate(this.selectedDateIndex-1)},nextDate(){this.selectedDateIndex<this.availableDates.length-1&&this.selectDate(this.selectedDateIndex+1)},selectSlot(r){r.booked||(this.selectedSlot=r,this.form.time=r.value,this.form.token_no=r.token_no,this.slotError="")},submitAppointment(){return p(this,null,function*(){if(!this.selectedSlot){this.slotError="Please select time slot";return}this.slotError="",this.isLoading=!0;try{const r=new FormData;r.append("name1",this.form.name),r.append("email",this.form.email),r.append("gender",this.form.gender),r.append("appointment_type",this.form.appointment_type),r.append("appointment_date",this.form.date),r.append("appointment_time",this.form.time),r.append("practitioner",this.form.doctor),r.append("department",this.form.department),r.append("notes",this.form.message||""),r.append("phone",this.form.phone),r.append("age",this.form.age),r.append("token_no",this.form.token_no),r.append("custom_location",this.form.custom_location);const n=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.create_appointment",{method:"POST",body:r})).json();console.log("\u2705 API Response:",n);const i=n.message||n;if(i.status==="success"){this.resetForm(),console.log("Practitioner ID from backend:",i.practitioner),this.$router.push({path:"/thank-you",state:{appointmentId:i.appointment_id,appointmentDate:i.appointment_date,appointmentTime:i.appointment_time,token_no:i.token_no,practitioner_id:i.practitioner}});return}this.message={text:i.message||"Failed to book appointment",type:"error"}}catch(r){console.error("Network/API Error:",r),this.message={text:"Something went wrong. Please try again.",type:"error"}}finally{this.isLoading=!1}})},resetForm(){this.form={name:"",gender:"",email:"",phone:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:""},this.doctors=[]}}},S={class:"px-4 py-10 grid grid-cols-1 lg:grid-cols-2 gap-6"},A={class:"bg-[#BFD2F8] p-4 rounded shadow"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},I={class:"flex flex-col"},E={class:"flex flex-col"},F={key:0,class:"text-red-500 text-sm mt-1"},U={class:"flex flex-col"},C={key:0,class:"text-red-500 text-sm mt-1"},P={class:"flex flex-col"},V={class:"flex flex-col"},j={class:"flex flex-col"},B=["value"],M={class:"flex flex-col"},L=["value"],N={class:"flex flex-col"},R={class:"flex flex-col md:col-span-2"},q={class:"flex flex-col md:col-span-2"},z={type:"submit",class:"w-full bg-[#065f7f] text-white py-2 font-bold rounded-lg hover:bg-[#162059] transition disabled:opacity-50"},G={key:0,class:"text-red-500 text-sm mt-3 text-center"},O={key:0,class:"bg-white rounded-lg p-4 shadow"},J={class:"text-xl font-bold leading-tight"},K={class:"flex justify-center items-center gap-4 mb-6"},W={class:"px-6 py-2 rounded-full bg-green-100 text-green-700"},H={class:"grid grid-cols-3 gap-3"},Q=["onClick","disabled"],X={class:"text-xs"};function Y(r,e,n,i,s,a){return l(),d(g,null,[e[31]||(e[31]=t("section",{class:"relative w-full bg-cover h-72",style:{"background-image":"url('/files/appointment-img.jpg')"}},[t("div",{class:"absolute inset-0 bg-white bg-opacity-50"}),t("div",{class:"relative z-10 flex items-center justify-center h-full text-center px-4"},[t("h1",{class:"text-3xl md:text-5xl lg:text-7xl font-bold text-[#065f7f]"}," Book an Appointment ")])],-1)),t("section",S,[t("div",A,[t("form",{onSubmit:e[13]||(e[13]=_((...o)=>a.submitAppointment&&a.submitAppointment(...o),["prevent"])),class:"max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-6"},[t("div",T,[t("div",I,[e[16]||(e[16]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Name *",-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.form.name=o),required:"",placeholder:"Enter your name",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,s.form.name]])]),t("div",E,[e[17]||(e[17]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Phone *",-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.form.phone=o),onInput:e[2]||(e[2]=(...o)=>a.validatePhone&&a.validatePhone(...o)),maxlength:"10",placeholder:"Enter 10 digit mobile number",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[h,s.form.phone]]),s.errors.phone?(l(),d("p",F,m(s.errors.phone),1)):y("",!0)]),t("div",U,[e[18]||(e[18]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Age *",-1)),f(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.age=o),type:"number",onInput:e[4]||(e[4]=(...o)=>a.validateAge&&a.validateAge(...o)),placeholder:"Enter your age",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[h,s.form.age]]),s.errors.age?(l(),d("p",C,m(s.errors.age),1)):y("",!0)]),t("div",P,[e[20]||(e[20]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Gender *",-1)),f(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>s.form.gender=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[...e[19]||(e[19]=[t("option",{value:""},"Select Gender",-1),t("option",null,"Male",-1),t("option",null,"Female",-1)])],512),[[b,s.form.gender]])]),t("div",V,[e[22]||(e[22]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Department *",-1)),f(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.form.department=o),onChange:e[7]||(e[7]=(...o)=>a.fetchDoctors&&a.fetchDoctors(...o)),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[21]||(e[21]=t("option",{value:""},"Select Department",-1)),(l(!0),d(g,null,x(s.departments,o=>(l(),d("option",{key:o},m(o),1))),128))],544),[[b,s.form.department]])]),t("div",j,[e[24]||(e[24]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Doctor *",-1)),f(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>s.form.doctor=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[23]||(e[23]=t("option",{value:""},"Select Doctor",-1)),(l(!0),d(g,null,x(s.doctors,o=>(l(),d("option",{key:o.name,value:o.name},m(o.full_name||o.first_name),9,B))),128))],512),[[b,s.form.doctor]])]),t("div",M,[e[26]||(e[26]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Appointment Type *",-1)),f(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>s.form.appointment_type=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[25]||(e[25]=t("option",{value:""},"Select Type",-1)),(l(!0),d(g,null,x(s.appointment_types,o=>(l(),d("option",{key:o.name,value:o.appointment_type},m(o.appointment_type),9,L))),128))],512),[[b,s.form.appointment_type]])]),t("div",N,[e[27]||(e[27]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Email ",-1)),f(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>s.form.email=o),type:"email",placeholder:"Enter your email",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,s.form.email]])]),t("div",R,[e[28]||(e[28]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Location",-1)),f(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>s.form.custom_location=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,s.form.custom_location]])]),t("div",q,[e[29]||(e[29]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Message",-1)),f(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=o=>s.form.message=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,s.form.message]])])]),t("button",z,m(s.isLoading?"Submitting...":"SUBMIT"),1),s.slotError?(l(),d("p",G,m(s.slotError),1)):y("",!0)],32)]),t("div",null,[s.availableDates.length?(l(),d("div",O,[e[30]||(e[30]=t("h2",{class:"font-bold text-xl mb-4 text-[#065f7f]"}," Select Appointment Slots ",-1)),t("h3",J,m(s.selectedDoctor.first_name)+" "+m(s.selectedDoctor.department),1),t("div",K,[t("button",{onClick:e[14]||(e[14]=(...o)=>a.prevDate&&a.prevDate(...o)),class:"w-8 h-8 border rounded-full"},"\u2039"),t("div",W,m(a.formattedDate),1),t("button",{onClick:e[15]||(e[15]=(...o)=>a.nextDate&&a.nextDate(...o)),class:"w-8 h-8 border rounded-full"},"\u203A")]),t("div",H,[(l(!0),d(g,null,x(s.availableTimes,o=>{var c;return l(),d("button",{key:o.id,onClick:u=>!o.booked&&a.selectSlot(o),disabled:o.booked,class:w(["border rounded-lg py-2 text-sm transition w-full",o.booked?"bg-red-500 text-white cursor-not-allowed":((c=s.selectedSlot)==null?void 0:c.id)===o.id?"bg-green-500 text-white":"bg-white hover:bg-green-50 cursor-pointer"])},[t("div",null,m(a.formatTime(o.display)),1),t("div",X,"Token "+m(o.token_no),1)],10,Q)}),128))])])):y("",!0)])]),e[32]||(e[32]=t("div",{class:"max-w-xl mx-auto bg-white rounded-xl shadow-md p-6 text-center"},[t("p",{class:"text-gray-900 mb-4"}," To book an appointment directly, please call the number below. "),t("a",{href:"tel:07969288000",class:"inline-flex items-center justify-center w-full bg-[#065f7f] text-white font-medium py-2 rounded-lg hover:bg-blue-700 transition"}," Call 07969288000 ")],-1))],64)}var ee=D(k,[["render",Y]]);export{ee as default};
