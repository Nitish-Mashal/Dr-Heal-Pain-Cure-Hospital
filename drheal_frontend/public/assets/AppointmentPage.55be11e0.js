var l=(s,e,r)=>new Promise((a,n)=>{var i=c=>{try{f(r.next(c))}catch(x){n(x)}},o=c=>{try{f(r.throw(c))}catch(x){n(x)}},f=c=>c.done?a(c.value):Promise.resolve(c.value).then(i,o);f((r=r.apply(s,e)).next())});import{_ as D,a as d,c as p,b as t,t as m,F as h,l as g,n as v,e as w,R as _,k as u,S as b,T as y}from"./vendor.f56b1f2b.js";const k={name:"AppointmentPage",data(){return{isLoading:!1,departments:[],doctors:[],appointment_types:[],selectedDoctor:null,selectedSlot:null,isFetchingSlots:!1,selectedDateIndex:null,form:{name:"",gender:"",email:"",phone:"",age:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:""},schedule:[],availableDates:[],availableTimes:[],message:{text:"",type:""}}},created(){return l(this,null,function*(){try{const{department:s,doctor_id:e}=this.$route.query;if(s&&(this.form.department=s),e){this.form.doctor=e;const r=yield this.fetchDoctorById(e);r&&!this.doctors.find(a=>a.name===r.name)&&this.doctors.push(r)}this.form.department&&!this.form.doctor&&(yield this.fetchDoctors())}catch(s){console.error("Created hook error:",s)}})},computed:{formattedDate(){const s=this.availableDates[this.selectedDateIndex];return s?new Date(s.date).toDateString():""}},watch:{"form.doctor"(s){return l(this,null,function*(){!s||(this.selectedDoctor=yield this.fetchDoctorById(s),yield this.fetchDoctorSchedule())})}},mounted(){this.fetchDepartments(),this.fetchAppointmentTypes()},methods:{fetchDoctorById(s){return l(this,null,function*(){try{return(yield(yield fetch(`/api/method/drheal_frontend.api.App_api.get_doctor?id=${s}`)).json()).message||null}catch(e){return console.error("Doctor fetch error:",e),null}})},fetchAppointmentTypes(){return l(this,null,function*(){var r;const e=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.get_appointment_types")).json();((r=e.message)==null?void 0:r.status)==="success"&&(this.appointment_types=e.message.data)})},fetchDepartments(){return l(this,null,function*(){var r;const e=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.get_departments")).json();((r=e.message)==null?void 0:r.status)==="success"&&(this.departments=e.message.data.map(a=>a.department))})},fetchDoctors(){return l(this,null,function*(){var r;if(!this.form.department)return;const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_practitioners?department=${encodeURIComponent(this.form.department)}`)).json();((r=e.message)==null?void 0:r.status)==="success"&&(this.doctors=e.message.data)})},fetchDoctorSchedule(){return l(this,null,function*(){if(this.availableDates=[],this.availableTimes=[],this.selectedDateIndex=null,this.schedule=[],!!this.form.doctor)try{const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}`)).json();if(!Array.isArray(e.message))return;this.schedule=e.message,this.availableDates=this.generateNext7Days(this.schedule),this.availableTimes=[],this.availableDates.length&&(yield this.selectDate(0))}catch(s){console.error("Error fetching doctor schedule:",s)}})},generateNext7Days(s){const e=new Date,r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=[];for(let n=0;n<7;n++){const i=new Date;i.setDate(e.getDate()+n);const o=r[i.getDay()];s.some(f=>f.day===o)&&a.push({date:i.toISOString().split("T")[0],day:o})}return a},selectDate(s){return l(this,null,function*(){if(!!this.availableDates[s]&&!this.isFetchingSlots){this.isFetchingSlots=!0;try{this.selectedDateIndex=s,this.form.date=this.availableDates[s].date,this.availableTimes=[],this.selectedSlot=null;const r=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}&appointment_date=${this.form.date}`)).json();if(!Array.isArray(r.message))return;const a=Array.from(new Map(r.message.map(n=>[`${n.from_time}-${n.to_time}`,n])).values());this.availableTimes=a.map((n,i)=>({id:`${n.token_no}-${n.from_time}-${n.to_time}-${this.form.date}`,display:`${n.from_time} - ${n.to_time}`,value:n.from_time,token_no:n.token_no||i+1,booked:!!n.booked}))}catch(e){console.error("Error fetching slots:",e)}finally{this.isFetchingSlots=!1}}})},prevDate(){this.selectedDateIndex>0&&this.selectDate(this.selectedDateIndex-1)},nextDate(){this.selectedDateIndex<this.availableDates.length-1&&this.selectDate(this.selectedDateIndex+1)},selectSlot(s){s.booked||(this.selectedSlot=s,this.form.time=s.value,this.form.token_no=s.token_no)},submitAppointment(){return l(this,null,function*(){this.isLoading=!0;try{const s=new FormData;s.append("name1",this.form.name),s.append("email",this.form.email),s.append("gender",this.form.gender),s.append("appointment_type",this.form.appointment_type),s.append("appointment_date",this.form.date),s.append("appointment_time",this.form.time),s.append("practitioner",this.form.doctor),s.append("department",this.form.department),s.append("notes",this.form.message||""),s.append("phone",this.form.phone),s.append("age",this.form.age);const r=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.create_appointment",{method:"POST",body:s})).json();console.log("\u2705 API Response:",r);const a=r.message||r;if(a.status==="success"){this.resetForm(),this.$router.push({path:"/thank-you",state:{appointmentId:a.appointment_id,appointmentDate:a.appointment_date,appointmentTime:a.appointment_time}});return}this.message={text:a.message||"Failed to book appointment",type:"error"}}catch(s){console.error("Network/API Error:",s),this.message={text:"Something went wrong. Please try again.",type:"error"}}finally{this.isLoading=!1}})},resetForm(){this.form={name:"",gender:"",email:"",phone:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:""},this.doctors=[]}}},S={class:"px-4 py-10 grid grid-cols-1 lg:grid-cols-2 gap-6"},A={key:0,class:"bg-white rounded-lg p-4 shadow"},T={class:"text-xl font-bold leading-tight"},I={class:"flex justify-center items-center gap-4 mb-6"},F={class:"px-6 py-2 rounded-full bg-green-100 text-green-700"},j={class:"grid grid-cols-3 gap-3"},C=["onClick","disabled"],U={class:"text-xs"},V={class:"bg-[#BFD2F8] p-4 rounded shadow"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},B={class:"flex flex-col"},M={class:"flex flex-col"},E={class:"flex flex-col"},P={class:"flex flex-col"},L={class:"flex flex-col"},N={class:"flex flex-col"},R=["value"],z={class:"flex flex-col"},G={class:"flex flex-col md:col-span-2"},O=["disabled"];function W(s,e,r,a,n,i){return d(),p(h,null,[e[25]||(e[25]=t("section",{class:"relative w-full bg-cover h-72",style:{"background-image":"url('/files/appointment-img.jpg')"}},[t("div",{class:"absolute inset-0 bg-white bg-opacity-50"}),t("div",{class:"relative z-10 flex items-center justify-center h-full text-center px-4"},[t("h1",{class:"text-3xl md:text-5xl lg:text-7xl font-bold text-[#065f7f]"}," Book an Appointment ")])],-1)),t("section",S,[t("div",null,[n.availableDates.length?(d(),p("div",A,[e[12]||(e[12]=t("h2",{class:"font-bold text-xl mb-4 text-[#065f7f]"}," Select Appointment Slots ",-1)),t("h3",T,m(n.selectedDoctor.first_name)+" "+m(n.selectedDoctor.department),1),t("div",I,[t("button",{onClick:e[0]||(e[0]=(...o)=>i.prevDate&&i.prevDate(...o)),class:"w-8 h-8 border rounded-full"},"\u2039"),t("div",F,m(i.formattedDate),1),t("button",{onClick:e[1]||(e[1]=(...o)=>i.nextDate&&i.nextDate(...o)),class:"w-8 h-8 border rounded-full"},"\u203A")]),t("div",j,[(d(!0),p(h,null,g(n.availableTimes,o=>{var f;return d(),p("button",{key:o.id,onClick:c=>!o.booked&&i.selectSlot(o),disabled:o.booked,class:v(["border rounded-lg py-2 text-sm transition w-full",o.booked?"bg-red-500 text-white cursor-not-allowed":((f=n.selectedSlot)==null?void 0:f.id)===o.id?"bg-green-500 text-white":"bg-white hover:bg-green-50 cursor-pointer"])},[t("div",null,m(o.display),1),t("div",U,m(o.token_no),1)],10,C)}),128))])])):w("",!0)]),t("div",V,[t("form",{onSubmit:e[11]||(e[11]=_((...o)=>i.submitAppointment&&i.submitAppointment(...o),["prevent"])),class:"max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-6"},[t("div",q,[t("div",B,[e[13]||(e[13]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Name *",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.form.name=o),required:"",placeholder:"Enter your name",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},null,512),[[b,n.form.name]])]),t("div",M,[e[14]||(e[14]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Phone *",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.form.phone=o),required:"",placeholder:"Enter your phone",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},null,512),[[b,n.form.phone]])]),t("div",E,[e[15]||(e[15]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Age *",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.form.age=o),type:"number",required:"",placeholder:"Enter your age",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},null,512),[[b,n.form.age]])]),t("div",P,[e[17]||(e[17]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Gender *",-1)),u(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>n.form.gender=o),required:"",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},[...e[16]||(e[16]=[t("option",{value:""},"Select Gender",-1),t("option",null,"Male",-1),t("option",null,"Female",-1)])],512),[[y,n.form.gender]])]),t("div",L,[e[19]||(e[19]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Department *",-1)),u(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>n.form.department=o),onChange:e[7]||(e[7]=(...o)=>i.fetchDoctors&&i.fetchDoctors(...o)),required:"",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},[e[18]||(e[18]=t("option",{value:""},"Select Department",-1)),(d(!0),p(h,null,g(n.departments,o=>(d(),p("option",{key:o},m(o),1))),128))],544),[[y,n.form.department]])]),t("div",N,[e[21]||(e[21]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Doctor *",-1)),u(t("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>n.form.doctor=o),required:"",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},[e[20]||(e[20]=t("option",{value:""},"Select Doctor",-1)),(d(!0),p(h,null,g(n.doctors,o=>(d(),p("option",{key:o.name,value:o.name},m(o.full_name||o.first_name),9,R))),128))],512),[[y,n.form.doctor]])]),t("div",z,[e[23]||(e[23]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Appointment Type *",-1)),u(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>n.form.appointment_type=o),required:"",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},[e[22]||(e[22]=t("option",{value:""},"Select Type",-1)),(d(!0),p(h,null,g(n.appointment_types,o=>(d(),p("option",{key:o.name},m(o.appointment_type),1))),128))],512),[[y,n.form.appointment_type]])]),t("div",G,[e[24]||(e[24]=t("label",{class:"mb-1 font-semibold text-gray-700"},"Message",-1)),u(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=o=>n.form.message=o),rows:"3",placeholder:"Write your message",class:"px-2 py-1 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[#065f7f] transition"},null,512),[[b,n.form.message]])])]),t("button",{type:"submit",disabled:!n.selectedSlot||n.isLoading,class:"w-full bg-[#065f7f] text-white py-2 font-bold rounded-lg hover:bg-[#162059] transition"},m(n.isLoading?"Submitting...":"SUBMIT"),9,O)],32)])]),e[26]||(e[26]=t("div",{class:"max-w-xl mx-auto bg-white rounded-xl shadow-md p-6 text-center"},[t("p",{class:"text-gray-900 mb-4"}," To book an appointment directly, please call the number below. "),t("a",{href:"tel:07969288000",class:"inline-flex items-center justify-center w-full bg-[#065f7f] text-white font-medium py-2 rounded-lg hover:bg-blue-700 transition"}," Call 07969288000 ")],-1))],64)}var K=D(k,[["render",W]]);export{K as default};
