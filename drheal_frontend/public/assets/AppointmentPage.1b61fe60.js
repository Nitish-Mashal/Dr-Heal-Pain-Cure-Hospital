var f=(n,e,r)=>new Promise((a,t)=>{var i=u=>{try{p(r.next(u))}catch(v){t(v)}},o=u=>{try{p(r.throw(u))}catch(v){t(v)}},p=u=>u.done?a(u.value):Promise.resolve(u.value).then(i,o);p((r=r.apply(n,e)).next())});import{_,a as l,b as d,d as s,R as D,p as c,S as h,t as m,f as g,T as y,F as b,n as x,q as w}from"./vendor.42ac75eb.js";const k={name:"AppointmentPage",data(){return{isLoading:!1,slotError:" ",apiError:"",departments:[],doctors:[],appointment_types:[],selectedDoctor:null,selectedSlot:null,isFetchingSlots:!1,selectedDateIndex:null,form:{name:"",gender:"",email:"",phone:"",age:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:"",custom_location:""},errors:{phone:"",age:""},schedule:[],availableDates:[],availableTimes:[],message:{text:"",type:""}}},created(){return f(this,null,function*(){try{const{department:n,doctor_id:e}=this.$route.query;if(n&&(this.form.department=n),e){this.form.doctor=e;const r=yield this.fetchDoctorById(e);r&&!this.doctors.find(a=>a.name===r.name)&&this.doctors.push(r)}this.form.department&&!this.form.doctor&&(yield this.fetchDoctors())}catch(n){console.error("Created hook error:",n)}})},computed:{formattedDate(){const n=this.availableDates[this.selectedDateIndex];return n?new Date(n.date).toDateString():""}},watch:{"form.doctor"(n){return f(this,null,function*(){!n||(this.selectedDoctor=yield this.fetchDoctorById(n),yield this.fetchAppointmentTypes(n),yield this.fetchDoctorSchedule())})}},mounted(){this.fetchDepartments(),this.fetchAppointmentTypes()},methods:{formatTime(n){if(!n)return"";const e=n.split(":");return`${e[0]}:${e[1]}`},validatePhone(){this.form.phone=this.form.phone.replace(/\D/g,""),this.errors.phone=this.form.phone.length!==10?"Enter valid 10 digit number":""},validateAge(){this.errors.age=!this.form.age||this.form.age<=0?"Enter valid age":""},fetchDoctorById(n){return f(this,null,function*(){try{return(yield(yield fetch(`/api/method/drheal_frontend.api.App_api.get_doctor?id=${n}`)).json()).message||null}catch(e){return console.error("Doctor fetch error:",e),null}})},fetchAppointmentTypes(n){return f(this,null,function*(){var e;try{const a=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_appointment_types?practitioner=${n}`)).json();((e=a.message)==null?void 0:e.status)==="success"&&(this.appointment_types=a.message.data)}catch(r){console.error("Appointment type fetch error:",r)}})},fetchDepartments(){return f(this,null,function*(){var r;const e=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.get_departments")).json();((r=e.message)==null?void 0:r.status)==="success"&&(this.departments=e.message.data.map(a=>a.department))})},fetchDoctors(){return f(this,null,function*(){var r;if(!this.form.department)return;const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_practitioners?department=${encodeURIComponent(this.form.department)}`)).json();((r=e.message)==null?void 0:r.status)==="success"&&(this.doctors=e.message.data)})},fetchDoctorSchedule(){return f(this,null,function*(){if(this.availableDates=[],this.availableTimes=[],this.selectedDateIndex=null,this.schedule=[],!!this.form.doctor)try{const e=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}`)).json();if(!Array.isArray(e.message))return;this.schedule=e.message,this.availableDates=this.generateNext7Days(this.schedule),this.availableTimes=[],this.availableDates.length&&(yield this.selectDate(0))}catch(n){console.error("Error fetching doctor schedule:",n)}})},generateNext7Days(n){const e=new Date,r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=[];for(let t=0;t<7;t++){const i=new Date;i.setDate(e.getDate()+t);const o=r[i.getDay()];n.some(p=>p.day===o)&&a.push({date:i.toISOString().split("T")[0],day:o})}return a},selectDate(n){return f(this,null,function*(){if(!!this.availableDates[n]&&!this.isFetchingSlots){this.isFetchingSlots=!0;try{this.selectedDateIndex=n,this.form.date=this.availableDates[n].date,this.availableTimes=[],this.selectedSlot=null;const r=yield(yield fetch(`/api/method/drheal_frontend.api.Appointment_api.get_doctor_schedule?practitioner=${encodeURIComponent(this.form.doctor)}&appointment_date=${this.form.date}`)).json();if(!Array.isArray(r.message))return;const a=Array.from(new Map(r.message.map(t=>[`${t.from_time}-${t.to_time}`,t])).values());this.availableTimes=a.map((t,i)=>{var p;const o=(p=t.token_no)!=null?p:i+1;return{id:`${o}-${t.from_time}-${t.to_time}-${this.form.date}`,display:`${t.from_time} - ${t.to_time}`,value:t.from_time,token_no:`Token ${o}`,booked:Boolean(t.booked)}})}catch(e){console.error("Error fetching slots:",e)}finally{this.isFetchingSlots=!1}}})},prevDate(){this.selectedDateIndex>0&&this.selectDate(this.selectedDateIndex-1)},nextDate(){this.selectedDateIndex<this.availableDates.length-1&&this.selectDate(this.selectedDateIndex+1)},selectSlot(n){n.booked||(this.selectedSlot=n,this.form.time=n.value,this.form.token_no=n.token_no,this.slotError="")},submitAppointment(){return f(this,null,function*(){var n,e;if(!this.selectedSlot){this.slotError="Please select time slot";return}this.slotError="",this.apiError="",this.isLoading=!0;try{const r=new FormData;r.append("name1",this.form.name),r.append("email",this.form.email),r.append("gender",this.form.gender),r.append("appointment_type",this.form.appointment_type),r.append("appointment_date",this.form.date),r.append("appointment_time",this.form.time),r.append("practitioner",this.form.doctor),r.append("department",this.form.department),r.append("notes",this.form.message||""),r.append("phone",this.form.phone),r.append("age",this.form.age),r.append("token_no",this.selectedSlot.token_no),r.append("custom_location",this.form.custom_location);const t=yield(yield fetch("/api/method/drheal_frontend.api.Appointment_api.create_appointment",{method:"POST",body:r})).json();if(console.log("\u2705 API Response:",t),((n=t==null?void 0:t.message)==null?void 0:n.status)==="error"){this.apiError=t.message.message;return}if(((e=t==null?void 0:t.message)==null?void 0:e.status)==="success"){const i=t.message;this.resetForm(),this.$router.push({path:"/thank-you",state:{appointmentId:i.appointment_id,appointmentDate:i.appointment_date,appointmentTime:i.appointment_time,token_no:i.token_no,practitioner_id:i.practitioner}});return}}catch(r){console.error("Network/API Error:",r),this.apiError="Something went wrong. Please contact directly through given phone number."}finally{this.isLoading=!1}})},resetForm(){this.form={name:"",gender:"",email:"",phone:"",department:"",doctor:"",date:"",time:"",token_no:"",message:"",appointment_type:""},this.doctors=[]}}},S={class:"px-4 py-10 grid grid-cols-1 lg:grid-cols-2 gap-6"},A={class:"bg-[#BFD2F8] p-4 rounded shadow"},E={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},T={class:"flex flex-col"},I={class:"flex flex-col"},U={key:0,class:"text-red-500 text-sm mt-1"},F={class:"flex flex-col"},j={key:0,class:"text-red-500 text-sm mt-1"},C={class:"flex flex-col"},V={class:"flex flex-col"},P={class:"flex flex-col"},B=["value"],M={class:"flex flex-col"},L=["value"],N={class:"flex flex-col"},R={class:"flex flex-col md:col-span-2"},q={class:"flex flex-col md:col-span-2"},z=["disabled"],G={key:0,class:"text-red-500 text-sm mt-3 text-center"},O={key:1,class:"mt-3 text-sm text-red-600 text-center"},W={key:0,class:"bg-white rounded-lg p-4 shadow"},H={class:"text-xl font-bold leading-tight"},J={class:"flex justify-center items-center gap-4 mb-6"},K={class:"px-6 py-2 rounded-full bg-green-100 text-green-700"},Q={class:"grid grid-cols-3 gap-3"},X=["onClick","disabled"],Y={class:"text-xs"};function Z(n,e,r,a,t,i){return l(),d(b,null,[e[31]||(e[31]=s("section",{class:"relative w-full bg-cover h-72",style:{"background-image":"url('/files/appointment-img.jpg')"}},[s("div",{class:"absolute inset-0 bg-white bg-opacity-50"}),s("div",{class:"relative z-10 flex items-center justify-center h-full text-center px-4"},[s("h1",{class:"text-3xl md:text-5xl lg:text-7xl font-bold text-[#065f7f]"}," Book an Appointment ")])],-1)),s("section",S,[s("div",A,[s("form",{onSubmit:e[13]||(e[13]=D((...o)=>i.submitAppointment&&i.submitAppointment(...o),["prevent"])),class:"max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md space-y-6"},[s("div",E,[s("div",T,[e[16]||(e[16]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Name *",-1)),c(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.form.name=o),required:"",placeholder:"Enter your name",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,t.form.name]])]),s("div",I,[e[17]||(e[17]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Phone *",-1)),c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>t.form.phone=o),onInput:e[2]||(e[2]=(...o)=>i.validatePhone&&i.validatePhone(...o)),maxlength:"10",placeholder:"Enter 10 digit mobile number",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[h,t.form.phone]]),t.errors.phone?(l(),d("p",U,m(t.errors.phone),1)):g("",!0)]),s("div",F,[e[18]||(e[18]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Age *",-1)),c(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.form.age=o),type:"number",onInput:e[4]||(e[4]=(...o)=>i.validateAge&&i.validateAge(...o)),placeholder:"Enter your age",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,544),[[h,t.form.age]]),t.errors.age?(l(),d("p",j,m(t.errors.age),1)):g("",!0)]),s("div",C,[e[20]||(e[20]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Gender *",-1)),c(s("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.form.gender=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[...e[19]||(e[19]=[s("option",{value:""},"Select Gender",-1),s("option",null,"Male",-1),s("option",null,"Female",-1)])],512),[[y,t.form.gender]])]),s("div",V,[e[22]||(e[22]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Department *",-1)),c(s("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>t.form.department=o),onChange:e[7]||(e[7]=(...o)=>i.fetchDoctors&&i.fetchDoctors(...o)),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[21]||(e[21]=s("option",{value:""},"Select Department",-1)),(l(!0),d(b,null,x(t.departments,o=>(l(),d("option",{key:o},m(o),1))),128))],544),[[y,t.form.department]])]),s("div",P,[e[24]||(e[24]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Doctor *",-1)),c(s("select",{"onUpdate:modelValue":e[8]||(e[8]=o=>t.form.doctor=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[23]||(e[23]=s("option",{value:""},"Select Doctor",-1)),(l(!0),d(b,null,x(t.doctors,o=>(l(),d("option",{key:o.name,value:o.name},m(o.full_name||o.first_name),9,B))),128))],512),[[y,t.form.doctor]])]),s("div",M,[e[26]||(e[26]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Appointment Type *",-1)),c(s("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.form.appointment_type=o),class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},[e[25]||(e[25]=s("option",{value:""},"Select Type",-1)),(l(!0),d(b,null,x(t.appointment_types,o=>(l(),d("option",{key:o.name,value:o.appointment_type},m(o.appointment_type),9,L))),128))],512),[[y,t.form.appointment_type]])]),s("div",N,[e[27]||(e[27]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Email ",-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.form.email=o),type:"email",placeholder:"Enter your email",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,t.form.email]])]),s("div",R,[e[28]||(e[28]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Location",-1)),c(s("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>t.form.custom_location=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,t.form.custom_location]])]),s("div",q,[e[29]||(e[29]=s("label",{class:"mb-1 font-semibold text-gray-700"},"Message",-1)),c(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.form.message=o),rows:"3",class:"px-2 py-1 border rounded-lg focus:ring-2 focus:ring-[#065f7f]"},null,512),[[h,t.form.message]])])]),s("button",{type:"submit",disabled:t.isLoading,class:"w-full bg-[#065f7f] text-white py-2 font-bold rounded-lg hover:bg-[#162059] transition disabled:opacity-50"},m(t.isLoading?"Submitting...":"SUBMIT"),9,z),t.slotError?(l(),d("p",G,m(t.slotError),1)):g("",!0),t.apiError?(l(),d("p",O,m(t.apiError),1)):g("",!0)],32)]),s("div",null,[t.availableDates.length?(l(),d("div",W,[e[30]||(e[30]=s("h2",{class:"font-bold text-xl mb-4 text-[#065f7f]"}," Select Appointment Slots ",-1)),s("h3",H,m(t.selectedDoctor.first_name)+" "+m(t.selectedDoctor.department),1),s("div",J,[s("button",{onClick:e[14]||(e[14]=(...o)=>i.prevDate&&i.prevDate(...o)),class:"w-8 h-8 border rounded-full"},"\u2039"),s("div",K,m(i.formattedDate),1),s("button",{onClick:e[15]||(e[15]=(...o)=>i.nextDate&&i.nextDate(...o)),class:"w-8 h-8 border rounded-full"},"\u203A")]),s("div",Q,[(l(!0),d(b,null,x(t.availableTimes,o=>{var p;return l(),d("button",{key:o.id,onClick:u=>!o.booked&&i.selectSlot(o),disabled:o.booked,class:w(["border rounded-lg py-2 text-sm transition w-full",o.booked?"bg-red-500 text-white cursor-not-allowed":((p=t.selectedSlot)==null?void 0:p.id)===o.id?"bg-green-500 text-white":"bg-white hover:bg-green-50 cursor-pointer"])},[s("div",null,m(i.formatTime(o.display)),1),s("div",Y,m(o.token_no),1)],10,X)}),128))])])):g("",!0)])]),e[32]||(e[32]=s("div",{class:"max-w-xl mx-auto bg-white rounded-xl shadow-md p-6 text-center"},[s("p",{class:"text-gray-900 mb-4"}," To book an appointment directly, please call the number below. "),s("a",{href:"tel:07969288000",class:"inline-flex items-center justify-center w-full bg-[#065f7f] text-white font-medium py-2 rounded-lg hover:bg-blue-700 transition"}," Call 07969288000 ")],-1))],64)}var te=_(k,[["render",Z]]);export{te as default};
